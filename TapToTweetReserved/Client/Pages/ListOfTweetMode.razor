@attribute [Authorize]
@inject HttpClient HttpClient
@inject Toolbelt.Blazor.I18nText.I18nText I18nText

<TweetDialog @ref="TweetDialog" />

<ReservedTweetsList CssClass="tweet-index" Filter="@((SelectableReservedTweet t) => !t.IsTweeted)" OnClickTweet="OnClickTweet">
    <BeforeList>
        <div class="guide">
            <div class="text">
                @Localized.Guide_in_Home
            </div>
        </div>
    </BeforeList>
</ReservedTweetsList>

@code
{
    [CascadingParameter]
    private UIContext UIContext { get; set; }

    private Localized Localized = new Localized();

    private TweetDialog TweetDialog;

    protected override async Task OnInitializedAsync()
    {
        this.UIContext.PageTitle = () => AppInfo.AppTitle;
        this.Localized = await I18nText.GetTextTableAsync<Localized>(this);
        this.UIContext.SetMenuItem(new MenuItem { Caption = () => Localized.GotToEdit, Url = "/list-of-editmode" });
    }

    private async Task OnClickTweet(ReservedTweet tweet)
    {
        var posted = await this.TweetDialog.OpenAndPost(tweet);
        if (posted)
        {
            tweet.IsTweeted = true;
            await this.HttpClient.PutAsJsonAsync($"/api/reservedtweets/{tweet.Id}", tweet);
            this.StateHasChanged();
        }
    }
}

